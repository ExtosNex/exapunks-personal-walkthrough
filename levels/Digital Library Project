; NOTE This is a single threaded workflow,
; This could be modified to be multithreaded

XA:

MARK START
LINK 800
;TRAVEL HOST
COPY M X
SWIZ X 3 X
;X IS COUNTER FOR LOOP
MARK TRAVEL
LINK 800
SUBI X 1 X
TEST X = 0
FJMP TRAVEL


;GRAB FILE ID
COPY M X
SWIZ X 021 X
ADDI X 200 X
GRAB X
;SWITCH TO LOCAL COMMS
MODE
;MAKE BOT FOR COPY FUNC
REPL SCRIBE
;READ AND SEND
MARK PIRATE
COPY F M
TEST EOF
FJMP PIRATE

;WHEN FINISHED READING
DROP
KILL
MODE

;GET FILE ID
COPY M X
ADDI X 400 X
GRAB X


;TRAVEL HOST
COPY F X
SWIZ X 3 X
;X IS COUNTER FOR LOOP
MARK HOME
LINK -1
SUBI X 1 X
TEST X = -1
FJMP HOME
DROP



;REINIT
COPY T M
JUMP START

;ONLY WRITES
MARK SCRIBE
MAKE
MARK SCRIBE_LOOP
COPY M F
JUMP SCRIBE_LOOP




XB:

;FIND # OF BOOK NEEDED
GRAB 300
MARK ENTRIES
SEEK 1
ADDI X 1 X
TEST EOF
FJMP ENTRIES

;SAVE # VARIABLE
MODE
REPL SAVE
COPY X M
MODE


;GO TO START OF FILE
SEEK -9999

MARK SEND_ID
@REP 2
COPY F M
SEEK -1
@END

SEEK 1
;GRAB FILE ID VAR
MODE
SUBI M X T

MODE
COPY T M

SUBI X 1 X



COPY M T
TEST X = 0
FJMP SEND_ID
DROP
KILL
LINK 800
KILL

HALT


;SAVE VAR TO M
MARK SAVE
COPY M X
MARK SEND
COPY X M
JUMP SEND
